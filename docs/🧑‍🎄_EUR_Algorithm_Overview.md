# 🧑‍🎄 EUR ANOVA 算法概述

## 设计目标与应用场景

EUR (Exploration-Utilization-Refinement) ANOVA 采集函数专为心理学实验优化设计，旨在平衡探索新参数组合与利用已知有效配置的需求。

### 核心设计理念

- **不确定性导向**: 优先选择能最大化信息增益的候选点
- **交互效应建模**: 通过ANOVA分解捕获变量间的非线性交互
- **动态权重调整**: 根据学习阶段自动调节探索-利用平衡
- **混合变量支持**: 同时处理连续、离散和分类变量

### 应用场景

- 心理学实验参数优化
- 临床试验设计
- 教育干预研究
- 行为科学实验

## 算法架构

### 核心组件

1. **ANOVA效应引擎**: 分层计算主效应和交互效应
2. **动态权重引擎**: 基于收敛状态调整λ_t和γ_t参数
3. **局部采样器**: 生成扰动点进行效应估计
4. **覆盖计算器**: 基于Gower距离的多样性度量

### 信息融合公式

$$
EUR(x) = Info(x) \oplus \gamma_t \times Coverage(x)
$$

其中:

- $Info(x)$: 标准化后的信息项 (主效应 + $\lambda_t$ × 交互效应)
- $Coverage(x)$: 基于Gower距离的覆盖度量
- $\gamma_t$: 动态覆盖权重
- $\oplus$: 乘法或加法融合

## 关键特性

### 1. 多阶效应建模

- **一阶效应**: 单个变量的主效应
- **二阶效应**: 变量对的交互效应
- **三阶效应**: 变量三元组的交互效应

### 2. 动态权重机制

- **λ_t (交互权重)**: 基于SPS收敛检测或分段函数调整
- **γ_t (覆盖权重)**: 基于采样历史动态调节

### 3. 混合变量处理

- **连续变量**: 高斯扰动采样
- **分类变量**: 穷举或随机采样
- **整数变量**: 离散扰动保证整数约束

### 4. 性能优化

- **批量效应计算**: 单次模型调用处理所有效应
- **延迟初始化**: 按需创建计算引擎
- **内存效率**: 避免重复计算低阶效应

## 实现验证

经过全面代码审查，当前实现与原始设计公式高度一致，主要增强包括:

- **SPS收敛检测**: 更稳定的收敛状态估计
- **混合扰动策略**: 针对低基数分类变量的优化
- **序数似然支持**: 处理Likert量表等有序分类响应
- **模块化架构**: 便于扩展和维护

## 使用指南

### 配置参数

```python
# 基本配置
enable_main = True          # 启用主效应
enable_pairwise = True      # 启用二阶交互
enable_threeway = False     # 启用三阶交互

# 权重参数
lambda_min = 0.1           # 最小交互权重
lambda_max = 1.0           # 最大交互权重
gamma_max = 0.5            # 最大覆盖权重

# 采样参数
local_num = 10             # 局部扰动点数量
local_jitter_frac = 0.1    # 扰动幅度比例
```

### 最佳实践

1. **从小规模开始**: 先验证单变量和二阶交互
2. **监控收敛**: 使用SPS指标跟踪学习进度
3. **调整权重**: 根据实验阶段调节λ_t和γ_t
4. **验证覆盖**: 确保采样空间的均匀覆盖

## 技术栈

- **PyTorch**: 张量运算和自动微分
- **BoTorch**: 贝叶斯优化框架
- **GPyTorch**: 高斯过程实现
- **NumPy/SciPy**: 数值计算和统计函数

## 扩展性

算法设计支持多种扩展方向:

- **更高阶交互**: 理论上可扩展到任意阶数
- **自定义效应**: 可定义领域特定的效应类型
- **并行计算**: 批量处理天然支持GPU加速
- **多目标优化**: 可扩展为多目标采集函数
