#!/usr/bin/env python3
"""
è¯Šæ–­ï¼šCustomPoolBasedGenerator.gen() è¿”å›çš„å€¼æ˜¯å¦è¢«ä½¿ç”¨ï¼Ÿ
"""

print("""
ã€å…³é”®è¯Šæ–­é—®é¢˜ã€‘

æµç¨‹åº”è¯¥æ˜¯ï¼š

  1. AEPsych.SequentialStrategy.gen() 
       â†“
  2. è°ƒç”¨ CustomPoolBasedGenerator.gen(num_points=1, model=...)
       â†“
  3. CustomPoolBasedGeneratoråœ¨æ± ç‚¹ä¸Šè¯„ä¼°acqf
       â†“
  4. é€‰æ‹©acqfæœ€é«˜çš„æ± ç‚¹
       â†“
  5. è¿”å›è¯¥ç‚¹ç»™ AEPsych
       â†“
  6. sampling_loop.py æ¥æ”¶åˆ°è¯¥ç‚¹
       â†“
  7. evaluate(è¯¥ç‚¹)


ã€ä½ ç°åœ¨çœ‹åˆ°çš„ç°è±¡ã€‘

åœ¨ sampling_loop.py ä¸­æ¥æ”¶çš„æ˜¯ï¼š
  - Condition_IDï¼ˆçœ‹èµ·æ¥åƒè¡Œå·ï¼‰
  - æˆ–è€…è¿ç»­å€¼ï¼ˆ5.6, 4.0ç­‰ï¼‰

è¿™è¯´æ˜ï¼š

âŒ CustomPoolBasedGenerator.gen() è¿”å›çš„ç‚¹æ²¡æœ‰è¢«æ­£ç¡®ä¼ é€’å‡ºå»

å¯èƒ½çš„åŸå› ï¼š

1ï¸âƒ£  AEPsychçš„å˜æ¢å±‚åœ¨æ‹¦æˆª
    - åœ¨ aepsych/transforms/parameters.py ä¸­æœ‰å˜æ¢
    - å¯èƒ½æ”¹å˜äº†è¿”å›å€¼

2ï¸âƒ£  è¿”å›å€¼çš„æ ¼å¼ä¸å¯¹
    - CustomPoolBasedGenerator è¿”å› torch.Tensor
    - ä½† AEPsych æœŸæœ›ç‰¹å®šçš„æ ¼å¼

3ï¸âƒ£  EURé‡‡é›†å‡½æ•°è¦†ç›–äº†é‡‡æ ·å†³ç­–
    - EURåœ¨å¤–å±‚ç‹¬ç«‹è¯„ä¼°
    - æ²¡æœ‰ä½¿ç”¨ CustomPoolBasedGenerator çš„é€‰æ‹©

ã€éªŒè¯æ–¹æ³•ã€‘

åœ¨ CustomPoolBasedGenerator.gen() ä¸­æ·»åŠ è¯Šæ–­æ—¥å¿—ï¼š
""")

code = '''
def gen(self, num_points: int = 1, model = None, **kwargs):
    """
    """
    # ... existing code ...
    
    selected_points = self.pool_points[selected_pool_indices]
    
    # ğŸ“ å…³é”®è¯Šæ–­æ—¥å¿—
    logger.bind(
        action="POOL_GEN_RETURN",
        selected_indices=selected_pool_indices.tolist(),
        selected_points=selected_points.tolist(),
        shape=selected_points.shape,
        dtype=str(selected_points.dtype)
    ).info("ğŸ’¾ CustomPoolBasedGenerator è¿”å›çš„ç‚¹")
    
    return selected_points
'''

print(code)

print("""
ç„¶ååœ¨ sampling_loop.py ä¸­æ‰“å°æ¥æ”¶åˆ°çš„å€¼ï¼š

    response = server.handle_request(ask_message)
    x_dict = response["config"]
    
    logger.bind(
        action="SAMPLING_LOOP_RECEIVE",
        x_dict_keys=list(x_dict.keys()),
        x_dict=x_dict
    ).info("ğŸ“¥ sampling_loop æ¥æ”¶åˆ°çš„ç‚¹")

ã€å¯¹æ¯”ä¸¤ä¸ªæ—¥å¿—ã€‘

å¦‚æœï¼š
  CustomPoolBasedGenerator è¿”å› [2.8, 6.5, 2, 2, 0, 0]
  ä½† sampling_loop æ”¶åˆ°     [5.6, ...]  æˆ– Condition_ID

è¯´æ˜ï¼šä¸­é—´æŸä¸ªç¯èŠ‚æŠŠç‚¹æ”¹äº†ï¼

ã€æœ€å¯èƒ½çš„åŸå› ã€‘

AEPsych çš„ EUR é‡‡é›†å‡½æ•°å¯èƒ½åœ¨ CustomPoolBasedGenerator ä¹‹å¤–
ç‹¬ç«‹ç”Ÿæˆäº†é‡‡æ ·ç‚¹ï¼Œè€Œä¸æ˜¯ç”¨ CustomPoolBasedGenerator è¿”å›çš„ç‚¹ã€‚

è¿™ä¼šå¯¼è‡´ï¼š
  âœ… CustomPoolBasedGenerator.gen() æœ‰æ­£ç¡®çš„é€»è¾‘
  âŒ ä½†å®ƒçš„è¿”å›å€¼è¢«å¿½è§†äº†
  âŒ å®é™…é‡‡æ ·çš„æ˜¯ EUR ç”Ÿæˆçš„ç‚¹

ã€å¦‚æœæ˜¯è¿™æ ·ã€‘

é‚£å°±éœ€è¦æ”¹ EUR çš„é…ç½®ï¼Œè®©å®ƒç”¨ CustomPoolBasedGenerator è€Œä¸æ˜¯
è‡ªå·±ç”Ÿæˆé‡‡æ ·ç‚¹ã€‚
""")
